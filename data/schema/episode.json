{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://example.com/airesearch/schema/episode.json",
  "title": "Episode",
  "type": "object",
  "required": ["episode_id", "domain", "frames"],
  "properties": {
    "episode_id": {"type": "string"},
    "domain": {"type": "string", "enum": ["driving", "robotics"]},
    "source": {
      "type": "object",
      "properties": {
        "dataset": {"type": "string"},
        "split": {"type": "string"},
        "scene_id": {"type": "string"}
      },
      "additionalProperties": true
    },
    "cameras": {
      "type": "array",
      "description": "Canonical camera names present in frames[*].observations.cameras.",
      "items": {"type": "string"}
    },
    "waypoint_spec": {
      "type": "object",
      "description": "Target format for expert future waypoints (if present).",
      "properties": {
        "horizon_steps": {"type": "integer", "minimum": 1},
        "dt": {"type": "number", "exclusiveMinimum": 0},
        "frame": {"type": "string", "enum": ["ego"]},
        "units": {"type": "string", "enum": ["m"]}
      },
      "additionalProperties": false
    },
    "frames": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "required": ["t", "observations"],
        "properties": {
          "t": {"type": "number", "description": "Seconds since episode start"},
          "observations": {
            "type": "object",
            "properties": {
              "cameras": {
                "type": "object",
                "description": "Per-camera observations. Use canonical camera keys.",
                "additionalProperties": {
                  "type": "object",
                  "properties": {
                    "image_path": {"type": "string"},
                    "intrinsics": {"type": "array", "items": {"type": "number"}},
                    "extrinsics": {"type": "array", "items": {"type": "number"}}
                  },
                  "additionalProperties": true
                }
              },
              "state": {
                "type": "object",
                "description": "Low-dim ego state (speed, yaw_rate, etc.)",
                "additionalProperties": true
              },
              "map": {"type": "object", "additionalProperties": true}
            },
            "additionalProperties": true
          },
          "expert": {
            "type": "object",
            "properties": {
              "waypoints": {
                "type": "array",
                "description": "Future waypoints in ego frame (x forward, y left), meters.",
                "items": {
                  "type": "array",
                  "minItems": 2,
                  "maxItems": 2,
                  "items": {"type": "number"}
                }
              }
            },
            "additionalProperties": true
          },
          "actions": {"type": "object", "additionalProperties": true}
        },
        "additionalProperties": true
      }
    }
  },
  "additionalProperties": true
}
