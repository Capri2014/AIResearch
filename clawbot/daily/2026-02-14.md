# ClawBot Daily Log — 2026-02-14

## What changed today
- Waymo episode converter: make `image_path` portable + schema-compliant
  - Always write `frames[*].observations.cameras[*].image_path` as a **relative** path (`images/<ts>_<cam>.jpg`).
  - In `--no-write-images` mode, still emit deterministic relative paths (skip bytes I/O) so episodes still validate against `data/schema/episode.json`.
  - Synthetic (contract) episodes now also use relative `images/...` paths.

## Why it matters
- Episode shards become copyable/mountable across machines without path rewrites.
- Fixes a latent schema mismatch (`image_path` was `null` in `--no-write-images` mode).

## Next
- Run a smoke conversion on a small TFRecord (w/ and w/o `--no-write-images`) + validate against the JSON schema.
- Wire relative-path resolution into the PyTorch episodes dataloader (join on episode root).
# 2026-02-14

## What I shipped
- Fixed a hard crash in `training/pretrain/train_ssl_contrastive_v0.py`: the encoder was moved to `device` before `device` was defined.
- Added temporal SSL plumbing: an episodes-backed temporal-pair dataset + a minimal `train_ssl_temporal_contrastive_v0.py` script for InfoNCE on (t, t+k) within the same camera.

## Notes
- This enables the next planned SSL upgrade (temporal positives) without changing the existing multi-camera contrastive script.
- Next: run on real Waymo episode shards and record throughput/memory; tune loader knobs + cache sizing.

## Notes
- This unblocks running the SSL contrastive v0 pretrain end-to-end on episode shards (next: run + record throughput/memory).
# 2026-02-14 (ET) — ClawBot daily log

## Focus
Driving-first execution: **Waymo episodes → PyTorch SSL pretrain → waypoint BC → CARLA ScenarioRunner**.

## CL #1: make Waymo episode shards portable (relative `image_path` by default)

### What changed
- `data/waymo/convert.py`
  - TFRecord conversion now writes `image_path` as a path **relative to the episode JSON directory** (e.g. `images/<timestamp>_<cam>.jpg`) by default.
  - Added flags:
    - `--relative-image-paths` (default)
    - `--absolute-image-paths` (opt-out)

### Why
- Absolute paths make episode shards non-portable and break downstream training when moved between machines / environments.
- `training/pretrain/dataloader_episodes.py` already resolves relative paths against the episode JSON’s directory, so this makes the “Waymo → episodes → pretrain dataloader” contract cleaner and more robust.

### Follow-ups
- Decide whether to enforce relative paths in schema validation (or allow both but recommend relative).
- Add a tiny smoke test: convert a short TFRecord and load with `EpisodesFrameDataset(decode_images=True)`.

---

## CL #2: add PyTorch waypoint BC (image-conditioned) (v0)

### What changed
- Added `training/sft/dataloader_waypoint_bc.py`
  - Episode-backed dataset that yields `(image, waypoints)` pairs.
  - Resolves relative `image_path` against the episode JSON directory.
  - Includes a simple collator that stacks images + waypoint targets and emits validity masks.
- Added `training/sft/train_waypoint_bc_torch_v0.py`
  - Minimal image-conditioned behavior cloning loop (MSE) using `TinyMultiCamEncoder` + a small MLP waypoint head.
  - Optional `--pretrained-encoder` to initialize from SSL checkpoints (e.g. temporal InfoNCE).
- Updated `training/sft/README.md` with a runnable command snippet.

### Why
- This is the missing bridge from “episodes + SSL pretrain plumbing” to an actual *policy training* step.
- Lets us validate that episode shards contain enough to train a waypoint head (images + targets) before integrating CARLA eval.

### Next
- Add a simple eval loop (holdout split + waypoint ADE/FDE) and checkpoint selection.
- Wire the trained model into a `WaypointPolicyTorch` for sim rollouts.

---

## CL #3: CARLA ScenarioRunner eval runner — invoke SR + write reproducible artifacts

### What changed
- `sim/driving/carla_srunner/run_srunner_eval.py`
  - Added argparse + config serialization (`config.json`).
  - Best-effort git metadata capture (repo/commit/branch) embedded in `metrics.json`.
  - Implemented ScenarioRunner process invocation when `--scenario-runner-root` (or `SCENARIO_RUNNER_ROOT`) is available.
  - Always emits schema-compatible `metrics.json` with useful `raw` debugging info (cmd/returncode/stdout log), and supports `--dry-run` fallback.

### Why
- Turns the CARLA/ScenarioRunner piece from a pure stub into a runnable harness.
- Establishes the concrete eval artifacts we’ll want to keep stable while policy wiring + metrics parsing evolves.

### Next
- Add version-aware parsing of ScenarioRunner outputs into `scenarios[*]` fields (completion, infractions).
- Wire in a Torch waypoint policy wrapper so SR can run closed-loop against our model checkpoints.
