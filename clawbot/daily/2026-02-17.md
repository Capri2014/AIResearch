# 2026-02-17 Daily Notes

## Pipeline PR #3

**Focus:** SFT Checkpoint Loader for RL Pipeline Integration

### Changes

- **Added:** `training/rl/sft_checkpoint_loader.py` - Robust SFT checkpoint loading
  - Checkpoint format detection (WaypointBCModel, SFTWaypointModel, legacy)
  - Metadata extraction (horizon_steps, out_dim, encoder type)
  - `load_sft_checkpoint()`: Main loading function with component extraction
  - `validate_checkpoint()`: Compatibility validation
  - `inspect_checkpoint()`: Detailed checkpoint inspection
  - `compare_sft_vs_rl()`: Comparison utilities for SFT-only vs SFT+RL
  - CLI interface: `--inspect`, `--validate`, `--smoke`

### Checkpoint Format Support

| Format | Keys | Description |
|--------|------|-------------|
| WaypointBCModel | `encoder`, `head` | Full encoder + head weights |
| SFTWaypointModel | `sft_waypoints` | Frozen waypoint predictions |
| LegacyFormat | `model_state`, `state_dict` | Legacy checkpoint formats |

### Usage

```bash
# Load checkpoint
python -c "
from training.rl.sft_checkpoint_loader import load_sft_checkpoint
sft = load_sft_checkpoint('out/waypoint_bc/model.pt')
print(sft.summary())
"

# Inspect checkpoint structure
python -m training.rl.sft_checkpoint_loader \
  --inspect --checkpoint out/waypoint_bc/model.pt

# Validate for RL pipeline
python -m training.rl.sft_checkpoint_loader \
  --validate --checkpoint out/waypoint_bc/model.pt

# Smoke test
python -m training.rl.sft_checkpoint_loader --smoke
```

### Integration Pattern

```python
# SFT → RL pipeline integration
sft_ckpt = load_sft_checkpoint(sft_path)
rl_trainer = RLDeltaTrainer(sft_checkpoint=sft_ckpt)
# final_waypoints = sft_waypoints + delta_head(z)
```

### Next Steps

- [ ] PR review/merge
- [ ] Integrate with `train_rl_delta_waypoint.py` for automatic checkpoint loading
- [ ] Add checkpoint comparison metrics to `compare_sft_vs_rl.py`

## Pipeline Integration Status

```
Waymo episodes → SSL pretrain → waypoint BC → RL delta refinement → CARLA eval
                    ↓
              SFT checkpoint loader (new)
                    ↓
              Enables RL to start from trained SFT
```
