# 2026-02-17 Daily Notes

## Pipeline PR #8 (Daily Cadence)

**Focus:** CARLA Closed-Loop Waypoint BC Evaluation Script

### Changes

- **Added:** `training/eval/run_carla_closed_loop_eval.py` - Comprehensive closed-loop evaluation
  - WaypointBCModelWrapper for loading trained checkpoints
  - 5 evaluation scenarios: straight_clear, straight_cloudy, straight_night, straight_rain, turn_clear
  - ClosedLoopMetrics: route_completion, collisions, deviation tracking
  - ScenarioResult aggregation with success_rate, avg_route_completion
  - Smoke test for validation without CARLA server

- **Components:**
  - `ScenarioConfig`: weather, map, spawn/target points per scenario
  - `ClosedLoopMetrics`: episode-level closed-loop metrics
  - `ScenarioResult`: aggregated scenario results
  - `WaypointBCModelWrapper`: checkpoint loading and inference
  - `CARLAClosedLoopEvaluator`: vehicle control and episode running

### Pipeline Integration

Complete CARLA evaluation stage:
```
Waymo episodes → SSL pretrain → waypoint BC → CARLA eval
```

### Usage

```bash
# Smoke test (no CARLA required)
python -m training.eval.run_carla_closed_loop_eval --smoke

# Full evaluation with CARLA server
python -m training.eval.run_carla_closed_loop_eval \
  --checkpoint out/waypoint_bc/best_model.pt \
  --output-dir out/carla_closed_loop_eval

# Specific scenarios only
python -m training.eval.run_carla_closed_loop_eval \
  --checkpoint out/waypoint_bc/best_model.pt \
  --output-dir out/carla_eval_night \
  --scenarios straight_night
```

### Next Steps

- [ ] Run CARLA evaluation with trained checkpoint
- [ ] Compare offline ADE/FDE with closed-loop metrics
- [ ] Add collision/offroad detection sensors
